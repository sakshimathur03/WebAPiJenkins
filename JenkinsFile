pipeline {
 agent any
 environment {
 AZURE_CREDENTIALS_ID ='azure-service-principal'
 RESOURCE_GROUP = 'rg-jenkins'
 APP_SERVICE_NAME = 'webapijenkins3425'
 }
 stages {
 stage('Checkout Code') {
 steps {
 git branch: 'main', url: "https://github.com/sakshimathur03/WebAPiJenkins.git"
 }
}
 stage('Build') {
 steps {
 bat 'dotnet restore'
 bat 'dotnet build --configuration Release'
 bat 'dotnet publish -c Release -o publish/'
 }
 }
 
 stage('Deploy') {
 steps {
    withCredentials([azureServicePrincipal('azure-service-principal')]) {
          bat "az login --service-principal -u $AZURE_CREDENTIALS_USR -p $AZURE_CREDENTIALS_PSW --tenant $AZURE_CREDENTIALS_TEN"
          bat "powershell Compress-Archive -Path ./publish/* -DestinationPath ./publish.zip -Force"
          bat "az webapp deploy --resource-group $name --name myAppService --resource-group myResourceGroup --src-path ./publish.zip --type zip"
   }
}
}
 }
post{
success{
 echo 'Deployment Successful'
}
failure{
echo 'Deployment Failed'
}

}
}
